<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#000000">
    <title>Meme Meter - Live Solana Token Scanner</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        :root {
            --green: #00ff00;
            --red: #ff0055;
            --yellow: #ffc800;
            --blue: #00d4ff;
            --purple: #b400ff;
            --orange: #ff8800;
            --bg-primary: #0a0a0a;
            --bg-secondary: #121212;
            --bg-card: #1a1a1a;
            --border: rgba(255, 255, 255, 0.08);
            --text-primary: #ffffff;
            --text-secondary: #999999;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', system-ui, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            line-height: 1.5;
        }
        
        /* Header */
        .header {
            background: rgba(10, 10, 10, 0.98);
            backdrop-filter: blur(30px);
            border-bottom: 1px solid var(--border);
            padding: 16px 24px;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 24px rgba(0, 0, 0, 0.5);
        }
        
        .header-top {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }
        
        .logo-section {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .logo {
            font-size: 28px;
            font-weight: 900;
            color: var(--green);
            font-family: 'Monaco', 'Courier New', monospace;
            text-shadow: 0 0 20px rgba(0, 255, 0, 0.6);
            letter-spacing: -1px;
        }
        
        .brand-info {
            display: flex;
            flex-direction: column;
        }
        
        .brand-name {
            font-size: 20px;
            font-weight: 900;
            letter-spacing: -0.5px;
        }
        
        .brand-tagline {
            font-size: 11px;
            color: var(--text-secondary);
            font-weight: 600;
        }
        
        .header-stats {
            display: flex;
            gap: 20px;
            align-items: center;
        }
        
        .header-stat {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            font-weight: 700;
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--green);
            box-shadow: 0 0 12px rgba(0, 255, 0, 0.8);
            animation: pulse 2s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .status-dot.error {
            background: var(--red);
            box-shadow: 0 0 12px rgba(255, 0, 85, 0.8);
        }
        
        /* Live Stats Bar */
        .stats-bar {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, rgba(0, 255, 0, 0.05) 100%);
            border-bottom: 1px solid var(--border);
            padding: 20px 24px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 20px;
        }
        
        .stat-card {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        
        .stat-value {
            font-size: 28px;
            font-weight: 900;
            font-family: 'Monaco', monospace;
            line-height: 1;
        }
        
        .stat-label {
            font-size: 11px;
            font-weight: 700;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .stat-safe .stat-value { color: var(--green); }
        .stat-caution .stat-value { color: var(--yellow); }
        .stat-danger .stat-value { color: var(--red); }
        
        /* Filter Bar */
        .filter-bar {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
            padding: 16px 24px;
            display: flex;
            gap: 12px;
            overflow-x: auto;
            scrollbar-width: none;
        }
        
        .filter-bar::-webkit-scrollbar {
            display: none;
        }
        
        .filter-btn {
            padding: 10px 18px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 700;
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-secondary);
            border: 1px solid transparent;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.2s;
        }
        
        .filter-btn:hover {
            background: rgba(255, 255, 255, 0.08);
        }
        
        .filter-btn.active {
            background: var(--green);
            color: #000;
            border-color: var(--green);
            box-shadow: 0 4px 16px rgba(0, 255, 0, 0.3);
        }
        
        /* Main Container */
        .container {
            padding: 0 0 100px 0;
        }
        
        /* Token Grid */
        .token-grid {
            padding: 24px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        /* Token Card */
        .token-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.2s;
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .token-card:hover {
            background: rgba(30, 30, 30, 1);
            border-color: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }
        
        .token-card.new-flash {
            animation: newFlash 2s ease-out;
            border-color: var(--green);
        }
        
        @keyframes newFlash {
            0% {
                background: rgba(0, 255, 0, 0.15);
                border-color: var(--green);
            }
            100% {
                background: var(--bg-card);
                border-color: var(--border);
            }
        }
        
        /* Token Header */
        .token-header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 16px;
        }
        
        .token-icon-wrapper {
            position: relative;
            flex-shrink: 0;
        }
        
        .token-icon {
            width: 56px;
            height: 56px;
            border-radius: 12px;
            background: linear-gradient(135deg, var(--green) 0%, #00cc66 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: 900;
            color: #000;
            box-shadow: 0 4px 16px rgba(0, 255, 0, 0.3);
        }
        
        .token-icon.danger {
            background: linear-gradient(135deg, var(--red) 0%, #cc0044 100%);
            color: #fff;
            box-shadow: 0 4px 16px rgba(255, 0, 85, 0.3);
        }
        
        .token-icon.caution {
            background: linear-gradient(135deg, var(--yellow) 0%, #cc9900 100%);
            color: #000;
            box-shadow: 0 4px 16px rgba(255, 200, 0, 0.3);
        }
        
        .status-badge {
            position: absolute;
            top: -6px;
            right: -6px;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 9px;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }
        
        .status-new {
            background: var(--green);
            color: #000;
        }
        
        .status-migrating {
            background: var(--orange);
            color: #000;
        }
        
        .status-migrated {
            background: var(--blue);
            color: #000;
        }
        
        .token-main-info {
            flex: 1;
            min-width: 0;
        }
        
        .token-name-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 6px;
        }
        
        .token-name {
            font-size: 18px;
            font-weight: 900;
            letter-spacing: -0.3px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .token-symbol {
            font-size: 14px;
            font-weight: 700;
            color: var(--text-secondary);
            font-family: 'Monaco', monospace;
        }
        
        .dex-badge {
            padding: 3px 8px;
            border-radius: 6px;
            font-size: 10px;
            font-weight: 900;
            background: rgba(0, 212, 255, 0.15);
            color: var(--blue);
            border: 1px solid rgba(0, 212, 255, 0.3);
            text-transform: uppercase;
        }
        
        .token-address {
            font-size: 11px;
            font-family: 'Monaco', monospace;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .copy-btn {
            cursor: pointer;
            opacity: 0.5;
            transition: opacity 0.2s;
        }
        
        .copy-btn:hover {
            opacity: 1;
        }
        
        .risk-score-badge {
            flex-shrink: 0;
            padding: 12px 18px;
            border-radius: 10px;
            font-size: 24px;
            font-weight: 900;
            font-family: 'Monaco', monospace;
            line-height: 1;
            text-align: center;
        }
        
        .risk-safe {
            background: rgba(0, 255, 136, 0.15);
            color: var(--green);
            border: 2px solid rgba(0, 255, 136, 0.4);
        }
        
        .risk-caution {
            background: rgba(255, 200, 0, 0.15);
            color: var(--yellow);
            border: 2px solid rgba(255, 200, 0, 0.4);
        }
        
        .risk-danger {
            background: rgba(255, 0, 85, 0.15);
            color: var(--red);
            border: 2px solid rgba(255, 0, 85, 0.4);
            box-shadow: 0 0 20px rgba(255, 0, 85, 0.2);
        }
        
        /* Token Metrics Grid */
        .token-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 16px;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--border);
        }
        
        .metric {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        .metric-label {
            font-size: 10px;
            font-weight: 700;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .metric-value {
            font-size: 14px;
            font-weight: 900;
            font-family: 'Monaco', monospace;
        }
        
        .metric-value.positive {
            color: var(--green);
        }
        
        .metric-value.negative {
            color: var(--red);
        }
        
        .metric-value.neutral {
            color: var(--text-primary);
        }
        
        /* Price Changes */
        .price-changes {
            display: flex;
            gap: 12px;
            margin-top: 12px;
        }
        
        .price-change {
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 900;
            font-family: 'Monaco', monospace;
        }
        
        .price-change.positive {
            background: rgba(0, 255, 0, 0.1);
            color: var(--green);
        }
        
        .price-change.negative {
            background: rgba(255, 0, 85, 0.1);
            color: var(--red);
        }
        
        /* Loading State */
        .loading-container {
            padding: 80px 24px;
            text-align: center;
        }
        
        .spinner {
            width: 56px;
            height: 56px;
            border: 4px solid rgba(0, 255, 0, 0.1);
            border-top-color: var(--green);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin: 0 auto 24px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .loading-text {
            font-size: 16px;
            font-weight: 700;
            color: var(--text-secondary);
        }
        
        /* Toast Notification */
        .toast {
            position: fixed;
            top: 100px;
            right: 24px;
            background: linear-gradient(135deg, var(--green) 0%, #00dd88 100%);
            color: #000;
            padding: 16px 24px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 900;
            box-shadow: 0 8px 32px rgba(0, 255, 0, 0.5);
            transform: translateX(400px);
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            z-index: 2000;
            max-width: 320px;
        }
        
        .toast.show {
            transform: translateX(0);
            opacity: 1;
        }
        
        .toast.danger {
            background: linear-gradient(135deg, var(--red) 0%, #dd0055 100%);
            color: #fff;
        }
        
        /* Disclaimer */
        .disclaimer {
            background: rgba(255, 170, 0, 0.08);
            border: 1px solid rgba(255, 170, 0, 0.2);
            border-radius: 12px;
            padding: 16px 24px;
            margin: 24px;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
            line-height: 1.6;
        }
        
        .disclaimer-title {
            color: #ffaa00;
            font-weight: 900;
            margin-bottom: 8px;
            font-size: 13px;
        }
        
        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(10, 10, 10, 0.98);
            backdrop-filter: blur(30px);
            border-top: 1px solid var(--border);
            padding: 12px 24px;
            display: flex;
            justify-content: space-around;
            z-index: 1000;
            box-shadow: 0 -2px 24px rgba(0, 0, 0, 0.5);
        }
        
        .nav-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 24px;
            cursor: pointer;
            padding: 8px 16px;
            border-radius: 12px;
            transition: all 0.2s;
        }
        
        .nav-btn.active {
            color: var(--green);
            background: rgba(0, 255, 0, 0.05);
        }
        
        .nav-label {
            font-size: 11px;
            font-weight: 700;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .stats-bar {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .token-metrics {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .price-changes {
                flex-wrap: wrap;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="header-top">
            <div class="logo-section">
                <div class="logo">MM</div>
                <div class="brand-info">
                    <div class="brand-name">Meme Meter</div>
                    <div class="brand-tagline">Live Solana Token Scanner</div>
                </div>
            </div>
            <div class="header-stats">
                <div class="header-stat">
                    <div class="status-dot" id="statusDot"></div>
                    <span id="statusText">Connecting...</span>
                </div>
                <div class="header-stat">
                    <span id="pairCount">0 pairs</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Stats Bar -->
    <div class="stats-bar">
        <div class="stat-card stat-safe">
            <div class="stat-value" id="statTotal">0</div>
            <div class="stat-label">Total Scanned</div>
        </div>
        <div class="stat-card stat-safe">
            <div class="stat-value" id="statNew">0</div>
            <div class="stat-label">New (24h)</div>
        </div>
        <div class="stat-card stat-danger">
            <div class="stat-value" id="statDanger">0</div>
            <div class="stat-label">High Risk</div>
        </div>
        <div class="stat-card stat-caution">
            <div class="stat-value" id="statCaution">0</div>
            <div class="stat-label">Caution</div>
        </div>
        <div class="stat-card stat-safe">
            <div class="stat-value" id="statSafe">0</div>
            <div class="stat-label">Safe</div>
        </div>
    </div>

    <!-- Filter Bar -->
    <div class="filter-bar">
        <button class="filter-btn active" data-filter="all">All Tokens</button>
        <button class="filter-btn" data-filter="new">üÜï New</button>
        <button class="filter-btn" data-filter="migrating">üîÑ Migrating</button>
        <button class="filter-btn" data-filter="migrated">‚úÖ Migrated</button>
        <button class="filter-btn" data-filter="safe">Safe</button>
        <button class="filter-btn" data-filter="caution">Caution</button>
        <button class="filter-btn" data-filter="danger">High Risk</button>
        <button class="filter-btn" data-filter="raydium">Raydium</button>
        <button class="filter-btn" data-filter="orca">Orca</button>
        <button class="filter-btn" data-filter="pump">Pump.fun</button>
    </div>

    <!-- Main Container -->
    <div class="container">
        <!-- Disclaimer -->
        <div class="disclaimer">
            <div class="disclaimer-title">‚ö†Ô∏è DISCLAIMER</div>
            Educational tool only. Not financial advice. Risk scores are algorithmic estimates and may be inaccurate. Always DYOR (Do Your Own Research). Trading cryptocurrency involves substantial risk. You can lose all your money. We are not liable for any losses.
        </div>

        <!-- Token Grid -->
        <div class="token-grid" id="tokenGrid">
            <div class="loading-container">
                <div class="spinner"></div>
                <div class="loading-text">Scanning Solana blockchain...</div>
            </div>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <div class="bottom-nav">
        <button class="nav-btn active">
            <span>üìä</span>
            <span class="nav-label">Tokens</span>
        </button>
        <button class="nav-btn" onclick="window.open('https://twitter.com/mememeterapp', '_blank')">
            <span>üê¶</span>
            <span class="nav-label">Twitter</span>
        </button>
        <button class="nav-btn">
            <span>üìà</span>
            <span class="nav-label">Stats</span>
        </button>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast"></div>

    <script>
        // =================================================================
        // CONFIGURATION
        // =================================================================
        
        const CONFIG = {
            HELIUS_API_KEY: '3b625ec8-4be8-4348-b8dd-43addf34330c',
            DEXSCREENER_LATEST_API: 'https://api.dexscreener.com/token-profiles/latest/v1',
            DEXSCREENER_PAIRS_API: 'https://api.dexscreener.com/latest/dex/pairs/solana',
            REFRESH_INTERVAL: 10000, // 10 seconds
            MAX_TOKENS: 50,
            NEW_TOKEN_THRESHOLD: 3600000, // 1 hour
            MIGRATING_THRESHOLD: 86400000, // 24 hours
        };

        // =================================================================
        // STATE MANAGEMENT
        // =================================================================
        
        let allPairs = [];
        let displayedPairs = [];
        let currentFilter = 'all';
        let lastFetchTime = 0;
        let knownPairIds = new Set();
        let fetchCount = 0;

        // =================================================================
        // INITIALIZATION
        // =================================================================
        
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üöÄ Meme Meter - Live Scanner Starting...');
            setupEventListeners();
            startLiveScanning();
        });

        function setupEventListeners() {
            // Filter buttons
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    e.target.classList.add('active');
                    currentFilter = e.target.dataset.filter;
                    renderPairs();
                });
            });
        }

        // =================================================================
        // DATA FETCHING - CONTINUOUS LIVE UPDATES
        // =================================================================
        
        function startLiveScanning() {
            // Initial fetch
            fetchLatestPairs();
            
            // Continuous updates every 10 seconds
            setInterval(fetchLatestPairs, CONFIG.REFRESH_INTERVAL);
            
            console.log('‚úÖ Live scanning started - updating every 10 seconds');
        }

        async function fetchLatestPairs() {
            fetchCount++;
            console.log(`üì° Fetch #${fetchCount} - Getting latest pairs...`);
            updateStatus('active', 'Scanning...');

            try {
                // Get latest Solana pairs from DexScreener
                const response = await fetch('https://api.dexscreener.com/latest/dex/search?q=SOL');
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }

                const data = await response.json();
                
                if (data.pairs && data.pairs.length > 0) {
                    const solanaPairs = data.pairs
                        .filter(p => p.chainId === 'solana')
                        .slice(0, CONFIG.MAX_TOKENS);
                    
                    processNewPairs(solanaPairs);
                    updateStatus('active', 'Live');
                    lastFetchTime = Date.now();
                    
                    console.log(`‚úÖ Processed ${solanaPairs.length} pairs`);
                } else {
                    throw new Error('No pairs in response');
                }

            } catch (error) {
                console.error('‚ùå Fetch error:', error);
                updateStatus('error', 'Error');
                showToast('Connection error. Retrying...', 'danger');
            }
        }

        function processNewPairs(newPairs) {
            let newPairCount = 0;
            
            // Process each pair
            newPairs.forEach(pair => {
                const pairId = pair.pairAddress;
                const isNew = !knownPairIds.has(pairId);
                
                if (isNew) {
                    newPairCount++;
                    knownPairIds.add(pairId);
                }
                
                // Calculate comprehensive metrics
                const processedPair = {
                    id: pairId,
                    address: pairId,
                    name: pair.baseToken?.name || 'Unknown',
                    symbol: pair.baseToken?.symbol || 'UNK',
                    price: pair.priceUsd || '0',
                    priceChange1h: pair.priceChange?.h1 || 0,
                    priceChange6h: pair.priceChange?.h6 || 0,
                    priceChange24h: pair.priceChange?.h24 || 0,
                    liquidity: pair.liquidity?.usd || 0,
                    volume24h: pair.volume?.h24 || 0,
                    marketCap: pair.marketCap || 0,
                    fdv: pair.fdv || 0,
                    dex: pair.dexId || 'unknown',
                    url: pair.url || '',
                    createdAt: pair.pairCreatedAt || Date.now(),
                    txns24h: (pair.txns?.h24?.buys || 0) + (pair.txns?.h24?.sells || 0),
                    buys24h: pair.txns?.h24?.buys || 0,
                    sells24h: pair.txns?.h24?.sells || 0,
                    isNew: isNew,
                    firstSeen: Date.now()
                };
                
                // Determine status
                processedPair.status = determineStatus(processedPair);
                
                // Calculate risk score
                processedPair.riskScore = calculateRiskScore(processedPair);
                processedPair.riskLevel = getRiskLevel(processedPair.riskScore);
                
                // Update or add to allPairs
                const existingIndex = allPairs.findIndex(p => p.id === pairId);
                if (existingIndex >= 0) {
                    allPairs[existingIndex] = processedPair;
                } else {
                    allPairs.unshift(processedPair); // Add to beginning
                }
            });
            
            // Keep only most recent pairs
            if (allPairs.length > CONFIG.MAX_TOKENS) {
                allPairs = allPairs.slice(0, CONFIG.MAX_TOKENS);
            }
            
            // Show notification for new pairs
            if (newPairCount > 0) {
                showToast(`üî• ${newPairCount} new pair${newPairCount > 1 ? 's' : ''} detected!`);
            }
            
            updateStats();
            renderPairs();
        }

        function determineStatus(pair) {
            const age = Date.now() - pair.createdAt;
            
            // NEW: Less than 1 hour old
            if (age < CONFIG.NEW_TOKEN_THRESHOLD) {
                return 'new';
            }
            
            // MIGRATING: 1-24 hours old with low liquidity (simulating bonding curve)
            if (age < CONFIG.MIGRATING_THRESHOLD && pair.liquidity < 50000) {
                return 'migrating';
            }
            
            // MIGRATED: Older or has significant liquidity
            return 'migrated';
        }

        function calculateRiskScore(pair) {
            let score = 0;
            
            // Liquidity risk (0-30 points)
            if (pair.liquidity < 1000) score += 30;
            else if (pair.liquidity < 5000) score += 22;
            else if (pair.liquidity < 10000) score += 15;
            else if (pair.liquidity < 50000) score += 8;
            
            // Volume risk (0-20 points)
            if (pair.volume24h < 100) score += 20;
            else if (pair.volume24h < 1000) score += 14;
            else if (pair.volume24h < 10000) score += 7;
            
            // Price volatility (0-25 points)
            const maxChange = Math.max(
                Math.abs(pair.priceChange1h),
                Math.abs(pair.priceChange6h),
                Math.abs(pair.priceChange24h)
            );
            if (maxChange > 100) score += 25;
            else if (maxChange > 50) score += 18;
            else if (maxChange > 20) score += 10;
            else if (maxChange > 10) score += 5;
            
            // Age risk (0-15 points)
            const ageHours = (Date.now() - pair.createdAt) / (1000 * 60 * 60);
            if (ageHours < 1) score += 15;
            else if (ageHours < 6) score += 10;
            else if (ageHours < 24) score += 5;
            
            // Transaction activity risk (0-10 points)
            if (pair.txns24h < 10) score += 10;
            else if (pair.txns24h < 50) score += 6;
            else if (pair.txns24h < 100) score += 3;
            
            return Math.min(100, Math.max(0, Math.round(score)));
        }

        function getRiskLevel(score) {
            if (score >= 70) return 'danger';
            if (score >= 40) return 'caution';
            return 'safe';
        }

        // =================================================================
        // RENDERING
        // =================================================================
        
        function renderPairs() {
            const grid = document.getElementById('tokenGrid');
            
            // Remove loading if present
            const loading = grid.querySelector('.loading-container');
            if (loading) loading.remove();
            
            // Filter pairs based on current filter
            let filtered = allPairs;
            
            if (currentFilter === 'new') {
                filtered = allPairs.filter(p => p.status === 'new');
            } else if (currentFilter === 'migrating') {
                filtered = allPairs.filter(p => p.status === 'migrating');
            } else if (currentFilter === 'migrated') {
                filtered = allPairs.filter(p => p.status === 'migrated');
            } else if (currentFilter === 'safe') {
                filtered = allPairs.filter(p => p.riskLevel === 'safe');
            } else if (currentFilter === 'caution') {
                filtered = allPairs.filter(p => p.riskLevel === 'caution');
            } else if (currentFilter === 'danger') {
                filtered = allPairs.filter(p => p.riskLevel === 'danger');
            } else if (['raydium', 'orca', 'pump'].includes(currentFilter)) {
                filtered = allPairs.filter(p => p.dex.toLowerCase().includes(currentFilter));
            }
            
            if (filtered.length === 0) {
                grid.innerHTML = `
                    <div class="loading-container">
                        <div style="font-size: 64px; opacity: 0.3;">üîç</div>
                        <div class="loading-text">No tokens found for this filter</div>
                    </div>
                `;
                return;
            }
            
            grid.innerHTML = filtered.map(pair => createPairCard(pair)).join('');
            
            console.log(`üìä Rendered ${filtered.length} pairs (filter: ${currentFilter})`);
        }

        function createPairCard(pair) {
            const age = formatAge(Date.now() - pair.createdAt);
            const buyRatio = pair.txns24h > 0 ? ((pair.buys24h / pair.txns24h) * 100).toFixed(0) : 0;
            
            return `
                <div class="token-card ${pair.isNew ? 'new-flash' : ''}" onclick="window.open('${pair.url}', '_blank')">
                    <div class="token-header">
                        <div class="token-icon-wrapper">
                            <div class="token-icon ${pair.riskLevel}">
                                ${pair.symbol.substring(0, 2)}
                            </div>
                            <div class="status-badge status-${pair.status}">
                                ${pair.status === 'new' ? 'üÜï NEW' : pair.status === 'migrating' ? 'üîÑ MIG' : '‚úÖ DEX'}
                            </div>
                        </div>
                        <div class="token-main-info">
                            <div class="token-name-row">
                                <div class="token-name">${escapeHtml(pair.name)}</div>
                                <div class="token-symbol">$${pair.symbol}</div>
                                <div class="dex-badge">${pair.dex.toUpperCase()}</div>
                            </div>
                            <div class="token-address">
                                ${pair.address.substring(0, 8)}...${pair.address.substring(pair.address.length - 6)}
                                <span class="copy-btn" onclick="event.stopPropagation(); copyToClipboard('${pair.address}')">üìã</span>
                            </div>
                        </div>
                        <div class="risk-score-badge risk-${pair.riskLevel}">
                            ${pair.riskScore}
                        </div>
                    </div>
                    
                    <div class="price-changes">
                        ${formatPriceChange('1H', pair.priceChange1h)}
                        ${formatPriceChange('6H', pair.priceChange6h)}
                        ${formatPriceChange('24H', pair.priceChange24h)}
                    </div>
                    
                    <div class="token-metrics">
                        <div class="metric">
                            <div class="metric-label">Price</div>
                            <div class="metric-value neutral">$${formatPrice(pair.price)}</div>
                        </div>
                        <div class="metric">
                            <div class="metric-label">Liquidity</div>
                            <div class="metric-value neutral">${formatLiquidity(pair.liquidity)}</div>
                        </div>
                        <div class="metric">
                            <div class="metric-label">Volume 24h</div>
                            <div class="metric-value neutral">${formatVolume(pair.volume24h)}</div>
                        </div>
                        <div class="metric">
                            <div class="metric-label">Market Cap</div>
                            <div class="metric-value neutral">${formatMarketCap(pair.marketCap)}</div>
                        </div>
                        <div class="metric">
                            <div class="metric-label">Txns 24h</div>
                            <div class="metric-value neutral">${pair.txns24h}</div>
                        </div>
                        <div class="metric">
                            <div class="metric-label">Buy Ratio</div>
                            <div class="metric-value ${buyRatio >= 55 ? 'positive' : buyRatio <= 45 ? 'negative' : 'neutral'}">${buyRatio}%</div>
                        </div>
                        <div class="metric">
                            <div class="metric-label">Age</div>
                            <div class="metric-value neutral">${age}</div>
                        </div>
                        <div class="metric">
                            <div class="metric-label">Status</div>
                            <div class="metric-value neutral">${pair.status.toUpperCase()}</div>
                        </div>
                    </div>
                </div>
            `;
        }

        function formatPriceChange(label, change) {
            if (change === 0 || change === null || change === undefined) {
                return `<div class="price-change">${label}: --</div>`;
            }
            const className = change > 0 ? 'positive' : 'negative';
            const sign = change > 0 ? '+' : '';
            return `<div class="price-change ${className}">${label}: ${sign}${change.toFixed(2)}%</div>`;
        }

        function formatPrice(price) {
            const p = parseFloat(price);
            if (p >= 1) return p.toFixed(4);
            if (p >= 0.0001) return p.toFixed(6);
            return p.toExponential(2);
        }

        function formatLiquidity(liq) {
            if (liq >= 1000000) return `$${(liq / 1000000).toFixed(2)}M`;
            if (liq >= 1000) return `$${(liq / 1000).toFixed(1)}K`;
            return `$${Math.floor(liq)}`;
        }

        function formatVolume(vol) {
            if (vol >= 1000000) return `$${(vol / 1000000).toFixed(2)}M`;
            if (vol >= 1000) return `$${(vol / 1000).toFixed(1)}K`;
            return `$${Math.floor(vol)}`;
        }

        function formatMarketCap(mc) {
            if (!mc || mc === 0) return '--';
            if (mc >= 1000000) return `$${(mc / 1000000).toFixed(2)}M`;
            if (mc >= 1000) return `$${(mc / 1000).toFixed(1)}K`;
            return `$${Math.floor(mc)}`;
        }

        function formatAge(ms) {
            const seconds = Math.floor(ms / 1000);
            const minutes = Math.floor(seconds / 60);
            const hours = Math.floor(minutes / 60);
            const days = Math.floor(hours / 24);
            
            if (days > 0) return `${days}d`;
            if (hours > 0) return `${hours}h`;
            if (minutes > 0) return `${minutes}m`;
            return `${seconds}s`;
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showToast('Address copied!');
            });
        }

        // =================================================================
        // UI UPDATES
        // =================================================================
        
        function updateStats() {
            const total = allPairs.length;
            const newPairs = allPairs.filter(p => p.status === 'new').length;
            const danger = allPairs.filter(p => p.riskLevel === 'danger').length;
            const caution = allPairs.filter(p => p.riskLevel === 'caution').length;
            const safe = allPairs.filter(p => p.riskLevel === 'safe').length;
            
            document.getElementById('pairCount').textContent = `${total} pairs`;
            document.getElementById('statTotal').textContent = total;
            document.getElementById('statNew').textContent = newPairs;
            document.getElementById('statDanger').textContent = danger;
            document.getElementById('statCaution').textContent = caution;
            document.getElementById('statSafe').textContent = safe;
        }

        function updateStatus(status, text) {
            const dot = document.getElementById('statusDot');
            const statusText = document.getElementById('statusText');
            
            dot.className = 'status-dot' + (status === 'error' ? ' error' : '');
            statusText.textContent = text;
        }

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = 'toast show' + (type === 'danger' ? ' danger' : '');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 4000);
        }

        // =================================================================
        // ERROR HANDLING
        // =================================================================
        
        window.onerror = function(msg, url, lineNo, columnNo, error) {
            console.error('Global error:', msg, error);
            return false;
        };

        console.log('‚úÖ Meme Meter Live Scanner Ready');
    </script>
</body>
</html>
